
@model CPCAnnexureI
@{
    var queryId = ViewContext.RouteData.Values["Id"];
    ViewBag.Title = (queryId == null ? "Add New Annexure I" : "Edit Annexure I");
}

<style>
    #annexurelI th {
        text-align: center !important;
    }
    .field-validation-error {
        color :red;
    }
</style>
<form id="lead-frm" class="user-Profile" method="post" enctype="multipart/form-data">
    @Html.AntiForgeryToken()

    @Html.HiddenFor(x => x.Id)

    <div class="row">
        <div class="col-sm-12 text-right">
            <div class="btn-group" role="group">
                <a href="javascript://" onclick="window.history.back()" class="btn btn-default"><i class="fa fa-close"></i> Cancel / Back</a>
                <button type="submit" id="submit" class="btn btn-success"><i class="fa fa-check"></i> Submit</button>
            </div>
        </div>
    </div>


    <div class="row">
        <div class="col-sm-12">
            <div class="panel panel-default">
                @*<div class="panel-heading">
                        <span>Add Products</span>
                    </div>*@
                <div class="panel-body">
                    <h4> Annexure I </h4>
                    <div class="row">
                        <div class="col-sm-12">
                            <div class="row">
                                <div class="col-sm-4">
                                    <div class="row form-group">
                                        <label class="col-sm-4 text-left horizontal-label">Sr. Number</label>
                                        <div class="col-sm-8">
                                            @Html.TextBoxFor(x => x.SrNo, new { @class = "form-control input-sm", @type = "number", @required = "required", @autofocus = "true" })
                                            @Html.ValidationMessageFor(m => m.SrNo)
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-4">
                                    <div class="row form-group">
                                        <label class="col-sm-3 horizontal-label">Collection Date</label>
                                        <div class="col-sm-9">
                                            <div class="input-group input-group-sm">
                                                <input name="DateOfCollection" class="form-control input-sm" type="date" value="@Model.DateOfCollection.ToString("yyyy-MM-dd")" required autocomplete="off">
                                                <span class="input-group-addon">
                                                    <span class="fa fa-calendar"></span>
                                                </span>
                                            </div>
                                            @Html.ValidationMessageFor(m => m.DateOfCollection)
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>

                    <div class="row tb-padding">
                        <table id="annexurelI" class="table table-striped table-bordered table-hover">
                            <thead>
                                <tr>
                                    <th style="width:5% !important">Sr.No</th>
                                    <th>Cash Processing Cell</th>
                                    <th>Branch</th>
                                    <th>Denomination</th>
                                    <th style="width:10% !important">No. Of Bundles</th>
                                    <th>Total Amount</th>
                                    <th>Seal No.</th>
                                    <th>Shipment Receipt</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>

                        <div class="col-sm-1">
                            <label>&nbsp; &nbsp;</label> <br />
                            <button class="btn btn-primary btn-sm btn-custom" type="button" id="AddNewRow" title="Add New Row"><i class="fa fa-plus"></i> Add New Row</button>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-sm-12">
                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="row form-group">
                                        <label class="col-sm-6 horizontal-label">Cash Handed Over By <b>CPC</b> Staff Name</label>
                                        <div class="col-sm-6">
                                            @Html.DropDownListFor(x => x.CashHandedOverCPCStaffAId, (SelectList)ViewBag.EmployeeList, " Select Employee ", new { @class = "form-control input-sm select2" })
                                            @Html.ValidationMessageFor(m => m.CashHandedOverCPCStaffAId)
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="row form-group">
                                        <label class="col-sm-6 horizontal-label">Cash Handed Over By <b>CPC</b> Staff Name</label>
                                        <div class="col-sm-6">
                                            @Html.DropDownListFor(x => x.CashHandedOverCPCStaffBId, (SelectList)ViewBag.EmployeeList, " Select Employee ", new { @class = "form-control input-sm select2" })
                                            @Html.ValidationMessageFor(m => m.CashHandedOverCPCStaffBId)
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="row form-group">
                                        <label class="col-sm-6 horizontal-label">Cash Handed Over By <b>CIT</b> Staff Name</label>
                                        <div class="col-sm-6">
                                            @Html.DropDownListFor(x => x.CashHandedOverCITStaffAId, (SelectList)ViewBag.EmployeeList, " Select Employee ", new { @class = "form-control input-sm select2" })
                                            @Html.ValidationMessageFor(m => m.CashHandedOverCITStaffAId)
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="row form-group">
                                        <label class="col-sm-6 horizontal-label">Cash Handed Over By <b>CIT</b> Staff Name</label>
                                        <div class="col-sm-6">
                                            @Html.DropDownListFor(x => x.CashHandedOverCITStaffBId, (SelectList)ViewBag.EmployeeList, " Select Employee ", new { @class = "form-control input-sm select2" })
                                        </div>
                                    </div>
                                </div>

                            </div>
                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="row form-group">
                                        <label class="col-sm-6 horizontal-label"> <b>CPC</b> Staff Handing Over Cash and Verifying</label>
                                        <div class="col-sm-6">
                                            @Html.DropDownListFor(x => x.SignatureCPCHandingOverCashAId, (SelectList)ViewBag.EmployeeList, " Select Employee ", new { @class = "form-control input-sm select2" })
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="row form-group">
                                        <label class="col-sm-6 horizontal-label"><b>CPC</b> Staff Handing Over Cash and Verifying</label>
                                        <div class="col-sm-6">
                                            @Html.DropDownListFor(x => x.SignatureCPCHandingOverCashBId, (SelectList)ViewBag.EmployeeList, " Select Employee ", new { @class = "form-control input-sm select2" })
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-sm-12 text-right">
            <div class="btn-group" role="group">
                <a href="javascript://" onclick="window.history.back()" class="btn btn-default"><i class="fa fa-close"></i> Cancel / Back</a>
                <button type="submit" id="submit" class="btn btn-success"><i class="fa fa-check"></i> Submit</button>
            </div>
        </div>
    </div>

    <select id="listBranches" style="display:none;"></select>
    <select id="listDenomination" style="display:none;"></select>
</form>


@section scripts{

    <script type="text/javascript">
        $(document).ready(function () {
            //-- Read Only Mode Trigger -//
            @*if ('@ViewData["IsView"]' != '') {
                $("input").attr("readonly", true);
                $("#IsActive").attr("disabled", true);
                $("#submit").hide();
            }*@


            generateBranchDDL(branchArray);
            generateDenomDDL(denomArray);

            //$("#txtVoucherDate").mask("99-99-9999");
            var accountGridRowIndex;

            @*$('#txtVoucherDate').datepicker({
            dateFormat: 'dd-mm-yy',
            prevText: '<i class="fa fa-chevron-left"></i>',
            nextText: '<i class="fa fa-chevron-right"></i>',
            minDate: '@(new AppSession().getFinancialStartDate())',
            maxDate: '@(new AppSession().getFinancialEndDate())'
            });*@

            //Page Load
            var rowCount = $('#annexurelI tbody tr').length;
            if (rowCount == 0) {
                AddFirstRow(1);
                bindBranchDDL(0);
                bindDenomDDL(0);
                for (var i = 2; i <= 5; i++) {
                    AddNewRow(i);
                    bindBranchDDL(i - 1);
                    bindDenomDDL(i - 1);
                }
            }
            function isLastRow() {
                //debugger;
                return accountGridRowIndex == $("#annexurelI tr:last").attr("data-id");
            }

            //btn-remove Click
            $(document).on('click', '.btn-removeRow', function (e) {
                e.preventDefault();
                $(this).closest('tr').remove();
                //GetTotal();
            });

            $('#AddNewRow').click(function () {
                //debugger
                var rownum = $("#annexurelI tr:last").attr("data-id");
                rownum = parseInt(rownum) + 1;
                AddNewRow(rownum);
                bindBranchDDL(rownum - 1);
                bindDenomDDL(rownum - 1);
                $(".select2").select2();
            });

            $(".select2").select2();
        });

        //Functions
        function generateHtml(row) {
            var _html = '<tr class="rows" data-id="' + row + '">'
            _html += '<td class="text-center" > ' + row + '</td>'
            _html += '<td><input type="text" class="form-control input-sm" name="CPCAnnexureIDetail[' + (row - 1) + '].CashProcessingCell"></td>'

            // var branchList = generateBranchDDL(row - 1);
            //generateBranchDDL(row - 1, array);

            //generateBranchDDL(row);
            _html += '<td><select class="form-control input-sm select2" id="ddlBranch' + (row - 1) + '" name="CPCAnnexureIDetail[' + (row - 1) + '].ProjectBranchId">   </select></td>'
            _html += '<td><select class="form-control input-sm select2" id="ddlDenomination' + (row - 1) + '" name="CPCAnnexureIDetail[' + (row - 1) + '].DenominationId"></select></td>'

            _html += '<td><input type="number" class="form-control input-sm" name="CPCAnnexureIDetail[' + (row - 1) + '].NoOfBundles" pattern="[0-9]"></td>'
            _html += '<td><input type="number" class="form-control input-sm" name="CPCAnnexureIDetail[' + (row - 1) + '].TotalAmount" pattern="[0-9]"></td>'
            _html += '<td><input type="number" class="form-control input-sm" name="CPCAnnexureIDetail[' + (row - 1) + '].SealNo" pattern="[0-9]"></td>'
            _html += '<td><input type="number" class="form-control input-sm" name="CPCAnnexureIDetail[' + (row - 1) + '].ShipmentReciptNo" pattern="[0-9]"></td>'

            _html += '<td> <a href="javascript://" class="btn btn-xs btn-danger btn-removeRow" data-original-title="Delete"><i class="fa fa-trash"></i> Delete</a> </td></tr>';
           
            return _html;
        }

        var branchArray = @Html.Raw(Json.Encode(ViewBag.BrachList));
        var denomArray = @Html.Raw(Json.Encode(ViewBag.DenominationList));
        //console.log(array);

        function generateBranchDDL(array) {
            //debugger
            for (var i = 0; i < array.length; i++) {
                $("#listBranches").append($("<option /> ").val(array[i].Value).text(array[i].Text));
            }
        }
        function bindBranchDDL(row) {
            //debugger
            var options = $("#listBranches > option").clone();
            $("#annexurelI > tbody > tr #ddlBranch" + row + "").append(options);
        }

        function generateDenomDDL(array) {
            //debugger
            for (var i = 0; i < array.length; i++) {
                $("#listDenomination").append($("<option /> ").val(array[i].Value).text(array[i].Text));
            }
        }
        function bindDenomDDL(row) {
            //debugger
            var options = $("#listDenomination > option").clone();
            $("#annexurelI > tbody > tr #ddlDenomination" + row + "").append(options);
        }

        function AddFirstRow(row) {
            if (isEmptyLastRow()) {
                $('#annexurelI tbody').append(generateHtml(row));
                //$("#divGrid").find("input[type=text]").addClass("form-control input-sm"); //adding class to inputs in Grid
            }
        }

        function AddNewRow(row) {
            $('#annexurelI tr:last').after(generateHtml(row));
            //debugger
            //if (isEmptyLastRow()) {
            //    $('#annexurelI tr:last').after(generateHtml(row));
            //}
        }

        function isEmptyLastRow() {
            var test = $("#annexurelI tr:last td:eq(1)").find("input");
            return "" !== $("#annexurelI tr:last td:eq(1)").find("input").val() && "" !== $("#annexurelI tr:last td:eq(2)").find("input").val();
        }

        function GetTotal() {
            //debugger;
            debit = 0;
            credit = 0;
            //console.log(accountGridRowIndex);

            for (var i = 1; i < accountGridRowIndex; i++) {
                //console.log("For LOOP, i= " + i);
                if ($("#txt_AccountCode" + i).val() != "" && $("#txt_AccountName" + i).val() != "") {

                    debit += parseFloat($("#txt_Debit" + i).val());
                    credit += parseFloat($("#txt_Credit" + i).val());

                    //console.log("D :" + debit + "C :" + credit);
                }
                $("#txt_difference").val(parseFloat(debit - credit).toFixed(2));
                $("#TotalDebit").val(parseFloat(debit).toFixed(2));
                $("#TotalCredit").val(parseFloat(credit).toFixed(2));
            }
        }
    </script>
}

